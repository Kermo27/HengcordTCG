@using HengcordTCG.Shared.Models

<div class="border border-slate-800 bg-slate-900/50 rounded-xl overflow-hidden">
    <!-- Pack Header -->
    <div class="relative h-40 bg-gradient-to-br @GetGradient() p-6 flex items-center justify-center">
        <div class="absolute inset-0 opacity-20">
            <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMSIgY3k9IjEiIHI9IjEiIGZpbGw9IiNmZmYiLz48L3N2Zz4=')]"></div>
        </div>
        <div class="relative text-center">
            <i class="fa fa-box text-white drop-shadow-lg text-6xl"></i>
        </div>
    </div>

    <div class="p-6 space-y-4">
        <!-- Title -->
        <div>
            <h3 class="text-slate-100 text-xl font-semibold">@Pack.Name</h3>
            <p class="text-slate-400 text-sm">
                @(Pack.IsAvailable ? "Available Now" : "Currently Unavailable")
            </p>
        </div>

        <!-- Drop Rates -->
        <div class="space-y-2">
            <div class="flex justify-between text-sm">
                <span class="text-slate-500">Legendary</span>
                <span class="text-amber-400 font-semibold">@Pack.ChanceLegendary%</span>
            </div>
            <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-amber-500 to-orange-500" style="width: @Pack.ChanceLegendary%"></div>
            </div>

            <div class="flex justify-between text-sm">
                <span class="text-slate-500">Rare</span>
                <span class="text-purple-400 font-semibold">@Pack.ChanceRare%</span>
            </div>
            <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-purple-500 to-blue-500" style="width: @Pack.ChanceRare%"></div>
            </div>

            <div class="flex justify-between text-sm">
                <span class="text-slate-500">Common</span>
                <span class="text-slate-400 font-semibold">@Pack.ChanceCommon%</span>
            </div>
            <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                <div class="h-full bg-slate-500" style="width: @Pack.ChanceCommon%"></div>
            </div>
        </div>

        <!-- Price -->
        <div class="flex items-center justify-between pt-4 border-t border-slate-800">
            <div class="flex items-center gap-2">
                <i class="fa fa-coins text-amber-400 text-xl"></i>
                <span class="text-2xl font-bold text-amber-400">@Pack.Price.ToString("N0")</span>
            </div>
            @if (IsAuthenticated)
            {
                @if (UserGold >= Pack.Price)
                {
                    <span class="border border-emerald-500/50 text-emerald-400 text-xs px-2 py-1 rounded">Affordable</span>
                }
                else
                {
                    <span class="border border-red-500/50 text-red-400 text-xs px-2 py-1 rounded">Need @((Pack.Price - UserGold).ToString("N0")) more</span>
                }
            }
        </div>
    </div>

    <div class="p-6 pt-0">
        @if (IsAuthenticated)
        {
            <button 
                @onclick="OnBuy"
                disabled="@(!Pack.IsAvailable || UserGold < Pack.Price)"
                class="@GetButtonClass() w-full h-12 text-base font-semibold rounded-lg">
                <i class="fa fa-shopping-cart mr-2"></i>
                @(UserGold < Pack.Price ? "Insufficient Gold" : "Buy Pack")
            </button>
        }
        else
        {
            <button 
                @onclick="OnBuy"
                class="w-full h-12 text-base font-semibold rounded-lg bg-indigo-500 hover:bg-indigo-600 text-white">
                <i class="fa fa-sign-in mr-2"></i> Login to Purchase
            </button>
        }
    </div>
</div>

@code {
    [Parameter] public PackType Pack { get; set; } = default!;
    [Parameter] public long UserGold { get; set; }
    [Parameter] public bool IsAuthenticated { get; set; }
    [Parameter] public EventCallback OnBuy { get; set; }

    private string GetGradient() => Pack.Name.ToLower() switch
    {
        var n when n.Contains("legend") => "from-amber-600 via-orange-600 to-red-600",
        var n when n.Contains("rare") => "from-purple-600 via-indigo-600 to-blue-600",
        var n when n.Contains("basic") => "from-slate-600 via-gray-600 to-slate-700",
        _ => "from-emerald-600 via-teal-600 to-cyan-600"
    };

    private string GetButtonClass()
    {
        if (!Pack.IsAvailable) return "bg-slate-700 text-slate-400 cursor-not-allowed";
        if (UserGold < Pack.Price) return "bg-slate-700 text-slate-400 cursor-not-allowed";
        return "bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white";
    }
}
