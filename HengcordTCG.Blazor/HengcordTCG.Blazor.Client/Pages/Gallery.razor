@page "/gallery"
@inject HengcordTCGClient Client

<PageTitle>Gallery - HengcordTCG</PageTitle>

<div class="container py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-white mb-2">Card Gallery</h1>
        <p class="text-slate-400">Browse all @AllCards.Count cards in the game</p>
    </div>

    <!-- Stats -->
    <div class="grid grid-cols-3 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-slate-900/50 border border-slate-800 rounded-xl p-4 text-center">
            <div class="text-2xl font-bold text-slate-100">@AllCards.Count</div>
            <div class="text-xs text-slate-500 uppercase">Total</div>
        </div>
        <div class="bg-slate-900/50 border border-slate-800 rounded-xl p-4 text-center">
            <div class="text-2xl font-bold text-amber-400">@AllCards.Count(c => c.Rarity == Rarity.Legendary)</div>
            <div class="text-xs text-slate-500 uppercase">Legendary</div>
        </div>
        <div class="bg-slate-900/50 border border-slate-800 rounded-xl p-4 text-center">
            <div class="text-2xl font-bold text-purple-400">@AllCards.Count(c => c.Rarity == Rarity.Rare)</div>
            <div class="text-xs text-slate-500 uppercase">Rare</div>
        </div>
        <div class="bg-slate-900/50 border border-slate-800 rounded-xl p-4 text-center">
            <div class="text-2xl font-bold text-slate-400">@AllCards.Count(c => c.Rarity == Rarity.Common)</div>
            <div class="text-xs text-slate-500 uppercase">Common</div>
        </div>
    </div>

    <!-- Filters -->
    <div class="flex flex-wrap gap-2 mb-6">
        <button @onclick="() => Filter = null" class="px-4 py-2 rounded-lg @GetFilterClass(null)">
            All (@AllCards.Count)
        </button>
        @foreach (var type in Enum.GetValues<CardType>())
        {
            <button @onclick="() => Filter = type" class="px-4 py-2 rounded-lg @GetFilterClass(type)">
                @type (@AllCards.Count(c => c.CardType == type))
            </button>
        }
    </div>

    <!-- Cards Grid -->
    @if (IsLoading)
    {
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
            @for (int i = 0; i < 12; i++)
            {
                <div class="aspect-[3/4] bg-slate-800 rounded-xl animate-pulse"></div>
            }
        </div>
    }
    else
    {
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
            @foreach (var card in FilteredCards)
            {
                <div class="aspect-[3/4] rounded-xl overflow-hidden border-2 @GetBorderClass(card.Rarity)">
                    @if (!string.IsNullOrEmpty(card.ImagePath))
                    {
                        <img src="/api/images/@card.ImagePath" alt="@card.Name" class="w-full h-full object-cover">
                    }
                    <div class="absolute inset-x-0 bottom-0 p-2 bg-gradient-to-t from-black/90 to-transparent">
                        <p class="text-white text-sm font-medium truncate">@card.Name</p>
                    </div>
                </div>
            }
        </div>
    }
</div>

@code {
    private List<Card> AllCards = new();
    private CardType? Filter;
    private bool IsLoading = true;

    private List<Card> FilteredCards => Filter.HasValue 
        ? AllCards.Where(c => c.CardType == Filter.Value).ToList() 
        : AllCards;

    protected override async Task OnInitializedAsync()
    {
        AllCards = await Client.GetCardsAsync();
        IsLoading = false;
    }

    private string GetFilterClass(CardType? type) => Filter == type 
        ? "bg-amber-500 text-white" 
        : "bg-slate-800 text-slate-300 hover:bg-slate-700";

    private string GetBorderClass(Rarity rarity) => rarity switch
    {
        Rarity.Legendary => "border-amber-500/50 shadow-lg shadow-amber-500/20 relative",
        Rarity.Rare => "border-purple-500/50 shadow-lg shadow-purple-500/20 relative",
        _ => "border-slate-700/50 relative"
    };
}
