@using ModelCard = HengcordTCG.Shared.Models.Card

@inject HengcordTCGClient Client
@inject AuthService AuthService
@inject ToastService Toast

@if (IsLoading)
{
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        @for (int i = 0; i < 8; i++)
        {
            <Skeleton class="aspect-[3/4] rounded-lg" />
        }
    </div>
}
else
{
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
        @foreach (var card in FilteredCards)
        {
            <div class="relative group">
                <CardComponent Card="card" />
                <div class="absolute top-2 left-2">
                    <Badge class="@GetCardTypeBadgeClass(card.CardType)">
                        @GetCardTypeIcon(card.CardType) @card.CardType
                    </Badge>
                </div>
                <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity rounded-xl flex items-center justify-center gap-2">
                    <Button @onclick="() => OpenEditCard(card)" Size="ButtonSize.Icon" Variant="ButtonVariant.Secondary">
                        <LucideIcon Name="pencil" Size="16" />
                    </Button>
                    <Button @onclick="() => DeleteCard(card)" Size="ButtonSize.Icon" Variant="ButtonVariant.Destructive">
                        <LucideIcon Name="trash-2" Size="16" />
                    </Button>
                </div>
            </div>
        }
    </div>
    <!-- Debug: @FilteredCards.Count cards shown -->
}

@code {
    [Parameter] public List<ModelCard> AllCards { get; set; } = new();
    [Parameter] public CardType? CardFilter { get; set; }
    [Parameter] public bool IsLoading { get; set; }
    [Parameter] public EventCallback<ModelCard> OnEditCard { get; set; }
    [Parameter] public EventCallback<ModelCard> OnDeleteCard { get; set; }
    [Parameter] public EventCallback OnAddCard { get; set; }

    private List<ModelCard> FilteredCards => CardFilter.HasValue 
        ? AllCards.Where(c => c.CardType == CardFilter.Value).ToList() 
        : AllCards;

    private string GetCardTypeBadgeClass(CardType type) => type switch
    {
        CardType.Commander => "border-amber-500 text-amber-400",
        CardType.Unit => "border-blue-500 text-blue-400",
        CardType.Closer => "border-red-500 text-red-400",
        _ => "border-slate-500 text-slate-400"
    };

    private string GetCardTypeIcon(CardType type) => type switch
    {
        CardType.Commander => "ðŸ‘‘",
        CardType.Unit => "âš”ï¸",
        CardType.Closer => "ðŸŽ¯",
        _ => ""
    };

    private void OpenEditCard(ModelCard card) => OnEditCard.InvokeAsync(card);
    private void DeleteCard(ModelCard card) => OnDeleteCard.InvokeAsync(card);
    private void OpenAddCard() => OnAddCard.InvokeAsync();
}
